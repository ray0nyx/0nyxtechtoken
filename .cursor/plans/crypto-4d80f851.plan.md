---
name: Solana On-Chain Analysis & Copy Trading Enhancements
overview: ""
todos:
  - id: 56b0e203-f8a4-4c1b-a670-e7eba7a717c5
    content: Create WalletManager component for multi-wallet management
    status: pending
  - id: f74cf0e6-fc2f-4661-9b0f-5da4aa5e8236
    content: Create crypto-aggregation-service for data fetching
    status: pending
  - id: acf7e6b2-f605-4420-a0df-7725d85e3fb6
    content: Create WinRateGauge visualization component
    status: pending
  - id: d92e8990-c1e0-421a-b9ac-a25515a723a6
    content: Create CryptoPnLChart line chart component
    status: pending
  - id: 2909be1d-b7fe-4e7f-9c27-d8f87854998f
    content: Update CryptoAnalytics overview tab with new components
    status: pending
  - id: c5f0fc03-fc27-4d9a-bc71-30b385697416
    content: Remove refresh buttons from CryptoAnalytics.tsx header
    status: pending
  - id: 9d6754c5-265f-4996-bd5c-dd0aad30d2c8
    content: Replace mock data in BitcoinOnChainAnalysis with real API calls
    status: pending
  - id: dd8ed989-d8ac-44cb-89a8-f99bd690a693
    content: Implement timeframe filtering for Bitcoin on-chain data
    status: pending
  - id: d884e524-98bc-444a-88db-fd11d5ff69cb
    content: Remove any remaining mock data from CryptoAnalytics overview
    status: pending
  - id: 4764cfa5-5a0a-4337-b8bc-1974250b325f
    content: Wallet tracking already exists as 2nd tab
    status: pending
  - id: 1c1a872c-4a55-4d6a-829d-0e55db57aa1e
    content: Modernize CryptoAnalytics overview tab UI
    status: pending
  - id: 18fb4363-8b9d-423c-8d85-b9f7d75644b6
    content: Modernize BitcoinOnChainAnalysis UI
    status: pending
  - id: 4e85652f-8730-4925-adc2-40ca6a61cdb8
    content: Modernize SolanaDexAnalytics UI and connect to table
    status: pending
  - id: dee529ac-cd28-4a95-97a8-3de4c07a7d6a
    content: Remove refresh buttons from CryptoAnalytics.tsx header
    status: pending
  - id: de8fb565-add3-4896-b756-0c5393de9641
    content: Replace mock data in BitcoinOnChainAnalysis with real API calls
    status: pending
  - id: 62ecc70b-011e-4b5f-818a-def8a5a43431
    content: Implement timeframe filtering for Bitcoin on-chain data
    status: pending
  - id: c5dd467f-afd9-489f-a47c-5ba14e039b9b
    content: Remove any remaining mock data from CryptoAnalytics overview
    status: pending
  - id: 7873951f-97cd-4d48-a76b-8e2894be8db1
    content: Wallet tracking already exists as 2nd tab
    status: pending
  - id: 4f9aec87-eff2-4397-a939-71c673acdc60
    content: Modernize CryptoAnalytics overview tab UI
    status: pending
  - id: 39f60d41-b7db-41ac-9f71-25cf2e2f9ed5
    content: Modernize BitcoinOnChainAnalysis UI
    status: pending
  - id: beeb120b-20ff-4338-a7f4-8b073c5f6e96
    content: Modernize SolanaDexAnalytics UI and connect to table
    status: pending
  - id: 6f4f2a8f-1a4e-4238-b64a-267a59cd718b
    content: Create WalletManager component for multi-wallet management
    status: pending
  - id: e8306b90-f064-4f2d-ab31-096b4954fe27
    content: Create crypto-aggregation-service for data fetching
    status: pending
  - id: af166524-e68d-44eb-bfc0-2251c33d94b1
    content: Create WinRateGauge visualization component
    status: pending
  - id: dce1b6c7-435e-4731-9d5f-c23213995943
    content: Create CryptoPnLChart line chart component
    status: pending
  - id: d1d2c0f0-82e6-44e2-b173-aa221c2eb557
    content: Update CryptoAnalytics overview tab with new components
    status: pending
  - id: 34b6bb67-c8fa-453e-b644-62d2bbd4931f
    content: Remove refresh buttons from CryptoAnalytics.tsx header
    status: pending
  - id: fc7b5250-f073-457e-b4c4-defe776a95b6
    content: Replace mock data in BitcoinOnChainAnalysis with real API calls
    status: pending
  - id: 1d97e093-f686-4920-80f6-b43b8cb12ba6
    content: Implement timeframe filtering for Bitcoin on-chain data
    status: pending
  - id: 5a7d144b-9a70-4736-b96a-fe6830ed51a3
    content: Remove any remaining mock data from CryptoAnalytics overview
    status: pending
  - id: 35a51d7d-0d26-47f7-b606-32f63d5b23b5
    content: Wallet tracking already exists as 2nd tab
    status: pending
  - id: 66d4e3de-68ea-4235-9092-8dae8aaae0ee
    content: Modernize CryptoAnalytics overview tab UI
    status: pending
  - id: 20484234-41ea-45c7-a94c-61fdb254a805
    content: Modernize BitcoinOnChainAnalysis UI
    status: pending
  - id: 10558105-acc1-4395-a327-27b66402da24
    content: Modernize SolanaDexAnalytics UI and connect to table
    status: pending
  - id: 45d4dbca-e4d4-419a-b5b5-637d6fd08551
    content: Remove refresh buttons from CryptoAnalytics.tsx header
    status: pending
  - id: 47e088d8-92ac-4fa0-ac34-f1e562e97e09
    content: Replace mock data in BitcoinOnChainAnalysis with real API calls
    status: pending
  - id: 446d2a21-dcd6-445a-a4c7-97f54e151993
    content: Implement timeframe filtering for Bitcoin on-chain data
    status: pending
  - id: e13747a9-1d5e-44c8-a30b-d91671d6fca6
    content: Remove any remaining mock data from CryptoAnalytics overview
    status: pending
  - id: f6d30e0f-fa5b-4c71-90aa-9a04dc11ceb7
    content: Wallet tracking already exists as 2nd tab
    status: pending
  - id: ca18949a-fcd3-4579-bf55-75f8e33f3926
    content: Modernize CryptoAnalytics overview tab UI
    status: pending
  - id: 324a19d8-7eac-4590-bd72-0f5d16dd60e8
    content: Modernize BitcoinOnChainAnalysis UI
    status: pending
  - id: e146f2b9-29da-4207-8484-f82c4799f0c7
    content: Modernize SolanaDexAnalytics UI and connect to table
    status: pending
---

# Solana On-Chain Analysis & Copy Trading Enhancements

## Problem Analysis

1. **Missing Solana On-Chain Analysis**: No comprehensive Solana network analysis dashboard (unlike Bitcoin's detailed on-chain metrics)
2. **Copy Trading Leaderboard Empty**: Traders not displaying despite seeding function
3. **Missing Copy Wallet Button**: No quick way to copy wallet address or start copying
4. **Limited Copy Trading Features**: Need professional features for monitoring and executing copy trades

## 1. Create Solana On-Chain Analysis Component

### New File: `src/components/crypto/SolanaOnChainAnalysis.tsx`

Create comprehensive Solana on-chain dashboard similar to `BitcoinOnChainAnalysis.tsx`:

**Features:**

- **Network Metrics Tab:**
  - TPS (Transactions Per Second) - real-time and 24h average
  - Block time (current and average)
  - Active validator count
  - Total stake (SOL staked)
  - Epoch information (current epoch, epoch progress, time remaining)
  - Network health score
  - Slot height and block height

- **Token Analysis Tab:**
  - Top tokens by volume (24h, 7d, 30d)
  - Token price changes
  - Token distribution charts
  - New token launches
  - Token holder counts

- **Transaction Analysis Tab:**
  - Recent large transactions (>$10k, >$100k, >$1M)
  - Whale movements (wallet transfers)
  - DEX swap activity summary
  - Transaction volume over time
  - Top trading pairs

- **Supply Tab:**
  - Total SOL supply
  - Circulating supply
  - Staked vs unstaked ratio
  - Inflation rate
  - Supply growth chart

**Data Sources:**

- Solana RPC: `https://api.mainnet-beta.solana.com`
- Helius API (if available): For enhanced transaction parsing
- Jupiter API: For token prices and volume
- Solscan API: For additional metrics

**Implementation:**

```typescript
// Fetch from Solana RPC
- getSlot() - current slot
- getBlockHeight() - block height
- getEpochInfo() - epoch data
- getSupply() - supply metrics
- getRecentPrioritizationFees() - network congestion

// Fetch from Jupiter/CoinGecko
- Token prices
- Volume data
- Market cap

// Parse transaction data
- Large transfers
- DEX swaps
- Program interactions
```

## 2. Create Solana On-Chain Service

### New File: `src/lib/solana-onchain.ts`

Service functions to fetch Solana network data:

```typescript
export interface SolanaNetworkMetrics {
  tps: number;
  tps24h: number;
  blockTime: number;
  avgBlockTime: number;
  activeValidators: number;
  totalStake: number;
  currentEpoch: number;
  epochProgress: number;
  epochTimeRemaining: number;
  slotHeight: number;
  blockHeight: number;
  networkHealth: 'healthy' | 'degraded' | 'down';
}

export interface SolanaTokenMetric {
  mint: string;
  symbol: string;
  name: string;
  price: number;
  priceChange24h: number;
  volume24h: number;
  marketCap: number;
  holderCount: number;
}

export interface SolanaTransactionAnalysis {
  largeTransactions: LargeTransaction[];
  whaleMovements: WhaleMovement[];
  dexActivity: DexActivitySummary;
  totalVolume24h: number;
  transactionCount24h: number;
}

export async function fetchSolanaNetworkMetrics(): Promise<SolanaNetworkMetrics>
export async function fetchSolanaTokenMetrics(): Promise<SolanaTokenMetric[]>
export async function fetchSolanaTransactionAnalysis(): Promise<SolanaTransactionAnalysis>
export async function fetchSolanaSupplyMetrics(): Promise<SolanaSupplyMetrics>
```

## 3. Fix Copy Trading Leaderboard Display

### File: `src/components/crypto/CopyTradingLeaderboard.tsx`

**Issues to fix:**

1. Check if seeding actually runs and succeeds
2. Verify query filters aren't excluding all traders
3. Ensure `is_active` and `blockchain` filters are correct
4. Add error handling and logging

**Fixes:**

- Add console logs to debug seeding
- Check if `is_active` is set correctly in seed data
- Verify `blockchain: 'solana'` matches exactly
- Add fallback to show traders even if filters fail
- Display error message if seeding fails

**Code changes:**

```typescript
// Line 76-102: Enhance useEffect
useEffect(() => {
  const init = async () => {
    try {
      // Check if leaderboard is empty
      const { data, error } = await supabase
        .from('copy_trading_leaderboard')
        .select('id, wallet_address, is_active, blockchain')
        .limit(1);
      
      console.log('Leaderboard check:', { data, error });
      
      if (!error && (!data || data.length === 0)) {
        console.log('Leaderboard empty, seeding...');
        const count = await seedCopyTradingLeaderboard();
        console.log(`Seeded ${count} traders`);
        toast({
          title: 'Leaderboard Seeded',
          description: `${count} top traders added`,
        });
      } else if (data && data.length > 0) {
        console.log('Leaderboard already has data:', data.length);
      }
    } catch (e) {
      console.error('Seeding error:', e);
      toast({
        title: 'Warning',
        description: 'Failed to seed leaderboard. Showing existing traders.',
        variant: 'destructive'
      });
    }
    
    fetchTraders();
  };
  
  init();
}, [sortBy]);

// Line 104-124: Fix fetchTraders query
const fetchTraders = async () => {
  setLoading(true);
  try {
    // First try with filters
    let query = supabase
      .from('copy_trading_leaderboard')
      .select('*')
      .order(sortBy, { ascending: false, nullsLast: true })
      .limit(100);
    
    // Only add filters if they make sense
    query = query.eq('blockchain', 'solana');
    // Don't filter by is_active initially - show all, then filter in UI
    
    const { data, error } = await query;
    
    if (error) {
      console.error('Query error:', error);
      throw error;
    }
    
    console.log(`Fetched ${data?.length || 0} traders`);
    
    // Filter active traders in memory
    const activeTraders = (data || []).filter(t => t.is_active !== false);
    setTraders(activeTraders);
    
    if (activeTraders.length === 0 && data && data.length > 0) {
      console.warn('All traders are inactive');
    }
  } catch (error) {
    console.error('Error fetching leaderboard:', error);
    // ... error handling
  } finally {
    setLoading(false);
  }
};
```

## 4. Add Copy Wallet Button

### File: `src/components/crypto/CopyTradingLeaderboard.tsx`

**Add to table row (around line 286-350):**

```typescript
<TableHead className="text-slate-300">Action</TableHead>
// ...
<TableCell>
  <div className="flex items-center gap-2">
    <Button
      variant="ghost"
      size="sm"
      onClick={(e) => {
        e.stopPropagation(); // Prevent row click
        navigator.clipboard.writeText(trader.wallet_address);
        toast({
          title: 'Copied!',
          description: 'Wallet address copied to clipboard',
        });
      }}
      className="text-emerald-400 hover:text-emerald-300"
    >
      <Copy className="w-4 h-4 mr-1" />
      Copy Address
    </Button>
    <Button
      variant="default"
      size="sm"
      onClick={(e) => {
        e.stopPropagation();
        handleStartCopying(trader);
      }}
      className="bg-emerald-600 hover:bg-emerald-700"
    >
      <Zap className="w-4 h-4 mr-1" />
      Start Copying
    </Button>
  </div>
</TableCell>
```

**Add handler function:**

```typescript
const handleStartCopying = (trader: LeaderboardTrader) => {
  // Navigate to copy trading dashboard with pre-filled wallet
  navigate(`/crypto/copy-trading?wallet=${trader.wallet_address}`);
  // Or open modal with copy trading setup
  // setSelectedTrader(trader);
  // setShowCopyModal(true);
};
```

## 5. Enhance Copy Trading Features

### File: `src/pages/crypto/CopyTradingDashboard.tsx` or new component

**Add professional features:**

1. **Real-Time Monitoring:**

   - Live trade feed from copied wallets
   - Trade notifications (toast + sound)
   - Auto-refresh every 5-10 seconds
   - Highlight new trades

2. **Advanced Position Sizing:**

   - Percentage of portfolio
   - Fixed dollar amount
   - Dynamic sizing based on trader's position size
   - Max position limits per token
   - Total exposure limits

3. **Risk Management:**

   - Stop-loss per trade
   - Take-profit targets
   - Max daily loss limit
   - Max drawdown protection
   - Token blacklist/whitelist
   - Slippage protection

4. **Trade Filtering:**

   - Filter by token
   - Filter by trade size
   - Filter by DEX
   - Skip trades below threshold
   - Skip trades with high slippage

5. **Performance Tracking:**

   - P&L per copied wallet
   - Win rate per wallet
   - Total copy trading P&L
   - Comparison vs original trader
   - Performance charts

6. **Auto-Execution Options:**

   - Manual approval (default)
   - Auto-execute with conditions
   - Auto-execute all trades
   - Scheduled execution delays

**New Component: `src/components/crypto/CopyTradingMonitor.tsx`**

Real-time monitoring component:

```typescript
- Polls for new trades from copied wallets
- Displays trade feed
- Shows pending executions
- Allows quick approve/reject
- Shows execution status
```

## 6. Integrate Solana On-Chain Analysis

### File: `src/pages/crypto/CryptoAnalytics.tsx`

**Add new tab:**

```typescript
type TabType = 'overview' | 'wallet-tracking' | 'bitcoin-analysis' | 'solana-analytics' | 'solana-onchain' | 'copy-trading';

// Add tab button
<TabsList>
  // ... existing tabs
  <TabsTrigger value="solana-onchain">
    <Activity className="w-4 h-4 mr-2" />
    Solana On-Chain
  </TabsTrigger>
</TabsList>

// Add tab content
{activeTab === 'solana-onchain' && (
  <SolanaOnChainAnalysis />
)}
```

## 7. Update Seed Function

### File: `src/lib/seed-copy-trading-leaderboard.ts`

**Ensure all required fields are set:**

- Verify `is_active: true` is set
- Verify `blockchain: 'solana'` exactly matches
- Add `last_trade_at` timestamp
- Add `created_at` timestamp
- Ensure all numeric fields are valid (not null)

## Summary

**Files Created:**

1. `src/components/crypto/SolanaOnChainAnalysis.tsx` - Main dashboard component
2. `src/lib/solana-onchain.ts` - Service for fetching Solana network data
3. `src/components/crypto/CopyTradingMonitor.tsx` - Real-time monitoring component

**Files Modified:**

1. `src/components/crypto/CopyTradingLeaderboard.tsx` - Fix display, add copy button
2. `src/pages/crypto/CryptoAnalytics.tsx` - Add Solana on-chain tab
3. `src/lib/seed-copy-trading-leaderboard.ts` - Ensure proper seeding
4. `src/pages/crypto/CopyTradingDashboard.tsx` - Add professional features

**Key Features:**

- Comprehensive Solana network metrics
- Token analysis and insights
- Transaction and whale movement tracking
- Fixed leaderboard display
- Copy wallet button (address + start copying)
- Real-time trade monitoring
- Advanced risk management
- Performance tracking